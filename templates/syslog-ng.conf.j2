@version:3.5
@include "scl.conf"

# Define Global Options
options {
  flush_lines (0);
  time_reopen (10);
  log_fifo_size (1000);
  chain_hostnames (off);
  use_dns (no);
  use_fqdn (no);
  create_dirs (no);
  dns-cache-hosts (/etc/hosts);
  keep_hostname (yes);
  time-zone ("America/Chicago");
};


# Define input source
source s_sys {
  system();
  internal();
};

# Define remote logging destination
#destination d_syslogng_tls {
#  syslog("{{ syslogng_server_prefix }}.{{ syslogng_server_suffix }}" 
#  port("{{ syslogng_server_port }}")
#  transport("{{ syslogng_server_protocol }}")
#  tls(ca-dir("/etc/pki/tls/certs/{{ syslogng_server_prefix }}.{{ syslogng_server_suffix }}"))
#  );
#};

destination d_syslogng_tls {
  syslog("{{ syslogng_server_prefix }}.{{ syslogng_server_suffix }}"
  port("{{ syslogng_server_port }}")
  transport("{{ syslogng_server_protocol }}")
  tls( 
    ca-dir("/etc/pki/tls/certs/{{ syslogng_server_prefix }}.{{ syslogng_server_suffix }}")
    key-file("/etc/pki/tls/private/{{ syslogng_dn_prefix }}.{{ syslogng_dn_suffix }}/{{ syslogng_dn_prefix }}_privkey.pem")
    cert-file("/etc/pki/tls/certs/{{ syslogng_dn_prefix }}.{{ syslogng_dn_suffix }}/{{ syslogng_dn_prefix }}_cert.pem")) 
    ); 
};


# Define Destination for Remote Log
destination netlogpile { file(
"/var/log/syslogng.log"
owner(root) group(root) perm (0600)
create_dirs ( yes ) dir_perm( 0700 ));
};

log { source(s_sys);destination(d_syslogng_tls); };

log { source(s_sys);destination(netlogpile); };
